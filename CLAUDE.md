# 開発状況メモ

## サーバー起動方法
```bash
npm run dev
```

## アクセスURL
- **メインゲーム**: http://127.0.0.1:3000
- **譜面制作**: http://127.0.0.1:3000/chart-editor.html

## 確認済み動作状況 (2025-08-25 14:37)

✅ **サーバー正常起動確認済み**
- HTTPサーバーがポート3000で稼働中
- HTMLページが正常に配信されている
- アクセスログでブラウザからの接続確認済み

✅ **実装完了機能**
- "Crying Girl"楽曲の完全対応
  - MP3音楽ファイル配置済み
  - MOV動画ファイル配置済み  
  - 4つの難易度譜面ファイル作成済み
- 楽曲選択システム完成
- 難易度選択システム完成
- 譜面制作システム完成（リアルタイムプレビュー・編集機能付き）

✅ **UIテスト確認**
- メイン画面の楽曲カード表示
- 楽曲選択時のハイライト効果
- 難易度選択画面
- プレビュー再生機能

## 修正完了事項 (2025-08-25 14:45)

✅ **「ゲーム開始」問題修正**
- デバッグログ追加で問題箇所を特定
- ゲームエンジン初期化の確認処理追加
- エラーハンドリング強化

✅ **楽曲選択画面大幅改善**
- 背景動画プレビュー機能追加
- カスタムカラーテーマ対応
- 楽曲メタデータ表示（ジャンル、年、説明）
- ホバー時のビデオ再生

## songs.json設定方法（効率的な楽曲管理）

楽曲情報、MV表示、UI設定を全てJSONで管理：

```json
{
  "displayName": "表示用楽曲名",
  "artistDisplayName": "表示用アーティスト名", 
  "genre": "ジャンル",
  "year": 2024,
  "description": "楽曲説明文",
  "backgroundVideo": "assets/video/楽曲.mov",
  "color": {
    "primary": "#ff6b9d",    // メイン色
    "secondary": "#a8e6cf",  // セカンダリ色
    "accent": "#ffd93d"      // アクセント色
  },
  "ui": {
    "showBackgroundVideo": true,    // 背景動画表示
    "showPreviewOnHover": true,     // ホバー時プレビュー
    "animationStyle": "fade",       // アニメーション
    "cardSize": "large"             // カードサイズ
  }
}
```

## 現在のデバッグ状況 (2025-08-25 14:49)

### 🔧 実装済みデバッグ機能
- **Canvas描画確認**: 半透明背景とフレームカウンター追加
- **詳細ログ出力**: ゲーム初期化〜実行まで全工程をログ化
- **タイミング修正**: ゲームループのdeltaTime計算を改善
- **譜面データ確認**: 108個のノーツを含む有効な譜面データを確認済み

### 🎮 テスト手順
1. ブラウザで http://127.0.0.1:3000 にアクセス
2. "Crying Girl"を選択
3. 任意の難易度を選択（Easy推奨：108ノーツ）
4. "ゲーム開始"をクリック
5. **開発者コンソールで以下を確認**:
   ```
   Canvas resized to: [幅] x [高さ]
   RhythmGame.start() called
   Notes generated: 108
   Sample notes: [最初の5ノーツデータ]
   Starting game loop...
   Time: [経過秒]s
   Notes: [残りノーツ数]
   ```

### 🖥️ 期待される画面表示
- 黒い半透明背景
- 6本の白い縦線（レーン境界）
- シアン色のジャッジメントライン（画面下部）
- 上から降ってくるカラフルなノーツ
- 左上にデバッグ情報「Time: XXXs」「Notes: XXX」
- 下部にキー表示（A,S,D,G,H,J）
- スコア・コンボ表示

### ❗ トラブルシューティング
もしゲームが表示されない場合:
1. コンソールエラーの確認
2. Canvas要素のCSS z-index確認  
3. audio/video読み込みエラーの確認

## ファイル構成
```
/assets/audio/cryinggirl.mp3     ✅ 配置済み
/assets/video/cryinggirl.mov     ✅ 配置済み  
/assets/chart/cryinggirl_*.json  ✅ 4難易度分作成済み
```

## 技術仕様
- フロントエンド: Vanilla JavaScript + Canvas 2D
- サーバー: http-server (Node.js)
- 音楽形式: MP3
- 動画形式: MOV (ブラウザ対応)
- 譜面形式: JSON
- キー配置: A,S,D,G,H,J (6キー)