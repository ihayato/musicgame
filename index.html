<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beat Diffusion - ビートマニア風音楽ゲーム</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    
    <!-- OGP Meta Tags -->
    <meta property="og:title" content="Beat Diffusion - ビートマニア風音楽ゲーム">
    <meta property="og:description" content="リズムに合わせて鍵盤を叩く本格的なビートマニア風音楽ゲーム。4楽曲収録、難易度選択可能！">
    <meta property="og:image" content="https://otogame2-bnejg6nov-ikehayas-projects.vercel.app/ogp.png">
    <meta property="og:url" content="https://otogame2-bnejg6nov-ikehayas-projects.vercel.app/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Beat Diffusion">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Beat Diffusion - ビートマニア風音楽ゲーム">
    <meta name="twitter:description" content="リズムに合わせて鍵盤を叩く本格的なビートマニア風音楽ゲーム。4楽曲収録、難易度選択可能！">
    <meta name="twitter:image" content="https://otogame2-bnejg6nov-ikehayas-projects.vercel.app/ogp.png">
    
    <!-- Additional Meta -->
    <meta name="description" content="Beat Diffusion - ビートマニア風リズムゲーム。4楽曲収録、リアルタイム譜面エディタ機能付き。">
    <meta name="keywords" content="音楽ゲーム,リズムゲーム,ビートマニア,Beat Diffusion,譜面エディタ">
    <meta name="author" content="Beat Diffusion Team">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <div id="menu" class="screen active">
            <h1>Beat Diffusion</h1>
            <div id="songSelection" class="selection-step active">
                <h2>楽曲選択</h2>
                <div id="songList" class="song-list"></div>
            </div>
            
            <div id="difficultySelection" class="selection-step">
                <div id="selectedSongDisplay">
                    <div id="songBanner">
                        <video id="bannerVideo" muted loop></video>
                        <div class="banner-overlay"></div>
                        <div class="banner-content">
                            <h2 id="bannerSongTitle"></h2>
                            <p id="bannerSongArtist"></p>
                            <div class="banner-stats">
                                <span id="bannerDuration"></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="difficulty-grid">
                    <h3>難易度を選択してください</h3>
                    <div class="difficulty-cards">
                        <div class="difficulty-card" data-difficulty="easy">
                            <div class="difficulty-name">EASY</div>
                            <div class="difficulty-level">★☆☆☆</div>
                            <div class="difficulty-description">初心者向け</div>
                        </div>
                        <div class="difficulty-card" data-difficulty="normal">
                            <div class="difficulty-name">NORMAL</div>
                            <div class="difficulty-level">★★☆☆</div>
                            <div class="difficulty-description">基本レベル</div>
                        </div>
                        <div class="difficulty-card" data-difficulty="hard">
                            <div class="difficulty-name">HARD</div>
                            <div class="difficulty-level">★★★☆</div>
                            <div class="difficulty-description">上級者向け</div>
                        </div>
                        <div class="difficulty-card" data-difficulty="extreme">
                            <div class="difficulty-name">EXTREME</div>
                            <div class="difficulty-level">★★★★</div>
                            <div class="difficulty-description">最高難易度</div>
                        </div>
                    </div>
                </div>
                
                <div class="selection-controls">
                    <button id="backToSongBtn" class="control-btn back-btn">楽曲選択に戻る</button>
                    <button id="previewBtn" class="control-btn preview-btn">プレビュー</button>
                    <button id="startGameBtn" class="control-btn start-btn" disabled>ゲーム開始</button>
                </div>
                
                <audio id="previewAudio" loop></audio>
            </div>
        </div>

        <div id="game" class="screen">
            <video id="bgVideo" muted tabindex="-1" playsinline disablePictureInPicture preload="auto"></video>
            <canvas id="gameCanvas"></canvas>
            <audio id="gameAudio"></audio>
            
            <div id="gameUI">
                <div id="score">Score: 0</div>
                <div id="combo">Combo: 0</div>
                <div id="judgment"></div>
            </div>
            
            <div id="keys">
                <div class="key" data-key="A">A</div>
                <div class="key" data-key="S">S</div>
                <div class="key" data-key="D">D</div>
                <div class="key" data-key="G">G</div>
                <div class="key" data-key="H">H</div>
                <div class="key" data-key="J">J</div>
            </div>
            
            <button id="backToMenu">メニューに戻る</button>
        </div>
    </div>

    <!-- Game Clear Screen -->
    <div id="gameClear" class="screen">
        <div class="clear-content">
            <div class="clear-title">
                <h1>GAME CLEAR!</h1>
            </div>
            
            <div class="clear-results">
                <div class="score-display">
                    <div class="score-item">
                        <span class="score-label">SCORE</span>
                        <span id="finalScore" class="score-value">0</span>
                    </div>
                    <div class="score-item">
                        <span class="score-label">MAX COMBO</span>
                        <span id="finalMaxCombo" class="score-value">0</span>
                    </div>
                </div>
                
                <div class="judgment-stats">
                    <div class="judgment-row perfect">
                        <span class="judgment-label">PERFECT</span>
                        <span id="perfectCount" class="judgment-count">0</span>
                    </div>
                    <div class="judgment-row good">
                        <span class="judgment-label">GOOD</span>
                        <span id="goodCount" class="judgment-count">0</span>
                    </div>
                    <div class="judgment-row poor">
                        <span class="judgment-label">POOR</span>
                        <span id="poorCount" class="judgment-count">0</span>
                    </div>
                    <div class="judgment-row miss">
                        <span class="judgment-label">MISS</span>
                        <span id="missCount" class="judgment-count">0</span>
                    </div>
                </div>
                
                <div class="accuracy-display">
                    <span class="accuracy-label">ACCURACY</span>
                    <span id="finalAccuracy" class="accuracy-value">0.00%</span>
                </div>
            </div>
            
            <div class="clear-controls">
                <button id="retryBtn" class="clear-btn retry-btn">もう一度</button>
                <button id="backToMenuFromClear" class="clear-btn menu-btn">メニューに戻る</button>
            </div>
        </div>
        
        <!-- Clear audio effect -->
        <audio id="clearAudio" preload="auto">
            <source src="gameclear.mp3" type="audio/mpeg">
        </audio>
    </div>

    <script src="game.js"></script>
    <script src="chart-generator.js"></script>
    <script src="app.js"></script>
    <script>
        // Debug: Check if all functions are loaded
        console.log('Scripts loaded check:');
        console.log('- initGame:', typeof initGame);
        console.log('- game variable:', typeof game);
        console.log('- RhythmGame class:', typeof RhythmGame);
    </script>
</body>
</html>